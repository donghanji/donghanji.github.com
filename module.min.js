/*
   module.js ,version 0.1.0 ,updated on 2013-10-27
   module for Plugins Modules library.

   https://github.com/donghanji/pm
 */

!function(a,b){var c=window.location.pathname,d={},e=Object.prototype.toString,f={version:"1.2.0",options:{require:!1,nocache:!1,debug:!1,timeout:7e3,mined:"",base:"",dirs:{},alias:{},files:[],coms:{},defaults:{},globals:{}},util:{},path:{}},g={SLASHDIR:/^\//,BASEDIR:/.*(?=\/.*$)/,JSSUFFIX:/\.js$/,COMMENT:/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,REQUIRE:/(?:^|[^.$])\brequire\s*\(\s*(["'])([^"'\s\)]+)\1\s*\)/g,REQUIRE_FUN:/^function \(\w*\)/,MODULENAME:/\/([\w.]+)?(?:\1)?$/,PLACEHOLDER_DIR:/\{(\S+)?\}(?:\1)?/},h={ERROR:-1,BEGIN:0,LOADING:1,LOADED:2,END:3};!function(a){a.extend=function(){var a,b=arguments[0]||{},c=arguments.length,d=1;for(c===d&&(b=this,--d);c>d;d++)if(a=arguments[d],"object"==typeof a)for(var e in a)b[e]=a[e];return b},a.extend({type:function(a){return null==a?String(a):d[e.call(a)]||"object"},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(b){return"string"===a.type(b)},isFunction:function(b){return"function"===a.type(b)},isObject:function(b){return"object"===a.type(b)},isArray:function(b){return"array"===a.type(b)}}),a.now=function(){return(new Date).getTime()},a.uid=function(){return a.now()+""+Math.floor(1e6*Math.random())},a.isEmpty=function(c){return""===c||c===b||null===c?!0:a.isArray(c)?c.length?!1:!0:a.isObject(c)?a.isEmptyObject(c):!1},a.isEmptyObject=function(a){for(var b in a)return!1;return!0},a.each=function(c,d){var e=0,f=c.length,g=f===b||a.isFunction(c);if(g){for(var h in c)if(d.call(c[h],h,c[h])===!1)break}else for(;f>e&&d.call(c[e],e,c[e++])!==!1;);},a.each("Boolean,Number,String,Function,Array,Date,RegExp,Object".split(","),function(a,b){d["[object "+b+"]"]=b.toLowerCase()}),a.keys=Object.keys||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},a.unique=function(b){var c={};return a.each(b,function(a,b){c[b]=1}),a.keys(c)},a.isInArray=function(b,c){if(!a.isArray(b))return!1;for(var d=0,e=b.length;e>d;d++)if(b[d]===c)return!0;return!1},a.parseDependencies=function(b){b=b.replace(g.COMMENT,"");var c,d=[],e=g.REQUIRE;for(e.lastIndex=0;c=e.exec(b);)c[2]&&d.push(c[2]);return a.unique(d)},a.path2name=function(b){if(a.isArray(b)){var c=[];return a.each(b,function(b,d){var d=a.path2name(d);c.push(d)}),c}var d=g.MODULENAME,e=d.exec(b);return e&&e.length>1&&(b=e[1].replace(g.JSSUFFIX,"")),b}}(f.util),function(a){a.dirname=function(a){var b=a.match(g.BASEDIR);return(b?b[0]:".")+"/"},a.realpath=function(a){var b=f.options.base;return a.indexOf("//")>-1||(a=b+a),a}}(f.path),function(){var a=f.path,b=f.options,d=a.dirname(c);b.base=d}(f.options);var i={},j=[],k={};!function(){var c=f.options,d=f.util,e=f.path;f.dirs=function(a){a=d.isObject(a)?a:{};var b=c.dirs,e=g.PLACEHOLDER_DIR;for(var f in a){var h=e.exec(a[f]),i=a[f];if(h&&h.length>1){var j=b[h[1]]||h[1]||"";i=i.replace(h[0],j)}a[f]=i}return a},f.init=function(b){b=d.isObject(b)?b:{},c=d.extend(c,b),c.alias=f.dirs(c.alias);var e=c.mined,g=/^\./;e=e&&!g.test(e)?"."+e:e,c.mined=e,c.require===!0&&(a.require=f.declare,a.define=f.declare,a.define.remove=f.remove),c.debug===!0&&(f.ModulesSet=i,f.ModuleCachesQueue=j,f.StatusCacheQueue=k,a.module=f,a.module.config=f.init)},f.alias=function(a){return d.isEmpty(a)?c.alias:(a=d.isObject(a)?a:{},a=f.dirs(a),c.alias=d.extend(a,c.alias),void 0)},f.files=function(a){if(d.isEmpty(a))return c.files;if(d.isString(a)&&(a=[].concat(a)),d.isObject(a)){var b=[];d.each(a,function(a){b.push(a)}),f.alias(a),a=b}c.files=d.unique(c.files.concat(a))},f.globals=function(a){return d.isEmpty(a)?c.globals:d.isString(a)?c.globals[a]||"":(a=d.isObject(a)?a:{},c.globals=d.extend(a,c.globals),void 0)},f.defaults=function(a,e){if(d.isEmpty(a))return c.defaults;if(d.isObject(a))for(var g in a)f.defaults(g,a[g]);else{if(a=f.aliasId(a),e===b)return c.defaults[a]||{};e=d.isObject(e)?e:{},c.defaults[a]=c.defaults[a]||{},c.defaults[a]=d.extend(e,c.defaults[a])}},f.scripts=function(){return document.getElementsByTagName("script")},f.createScript=function(a,c){c=c===b||c?!0:!1;var d=document.createElement("script");return d.setAttribute("data-requiremodule",a),d.type="text/javascript",d.charset="utf-8",d.async=c,d},f.getScriptData=function(a){var b=a.currentTarget||a.srcElement;return b.detachEvent?(b&&b.detachEvent("onreadystatechange",f.onScriptLoad),b&&b.detachEvent("error",f.onScriptError)):(b&&b.removeEventListener("load",f.onScriptLoad,!1),b&&b.removeEventListener("error",f.onScriptError,!1)),{node:b,id:b&&b.getAttribute("data-requiremodule")}},f.loadJS=function(a){var b=f.isInComs(a);if(a=null!==b?b:a,!(f.getStatus(a)>h.BEGIN)){f.statusSet(a,h.LOADING);var i=document.getElementsByTagName("head")[0],j=f.createScript(a),a=f.aliasId(a,"v"),k=e.realpath(a);k+=c.mined,g.JSSUFFIX.test(k)||(k+=".js"),c.nocache&&(k=k+"?t="+d.now()),j.src=k,i.appendChild(j),j.attachEvent?(j.attachEvent("onreadystatechange",f.onScriptLoad),j.attachEvent("onerror",f.onScriptError)):(j.addEventListener("load",f.onScriptLoad,!1),j.addEventListener("error",f.onScriptError,!1))}},f.removeJS=function(a){a=f.aliasId(a),d.each(f.scripts(),function(b,c){return c&&c.getAttribute("data-requiremodule")===a?(c.parentNode.removeChild(c),!0):void 0})},f.onScriptLoad=function(a){var b=a.currentTarget||a.srcElement;if("load"===a.type||"readystatechange"==a.type&&("loaded"===b.readyState||"complete"===b.readyState)){var c=f.getScriptData(a),d=c.id;f.statusSet(d,h.LOADED),f.isInFiles(d)&&f.compile(d)}},f.onScriptError=function(a){var b=f.getScriptData(a),c=b.id;f.statusSet(c,h.ERROR),f.compile(c),f.removeJS(c)},f.statusSet=function(a,b){a=f.aliasId(a),k[a]||(k[a]={}),k[a].status=b},f.getStatus=function(a){return a=f.aliasId(a),k[a]&&k[a].status||h.BEGIN},f.load=function(a){d.each(a,function(a,b){f.loadJS(b)})},f.isInAlias=function(a){var b=c.alias;for(var e in b){var f=d.path2name(b[e]);if(e===a||f===a||b[e]===a)return{k:e,v:b[e]}}return null},f.aliasId=function(a,b){b=b||"k";var c=f.isInAlias(a);return a=c&&c[b]||a},f.isInFiles=function(a){for(var b=c.files,a=f.aliasId(a),d=0,e=b.length;e>d;d++)if(b[d]===a)return!0;return!1},f.isInComs=function(a){var b=c.coms,e=f.aliasId(a),g=f.aliasId(a,"v");for(var h in b)if(e===h||d.isInArray(b[h],e)||d.isInArray(b[h],g))return h;return null},f.isInModules=function(a){return a=f.aliasId(a),i[a]},f.noInModulesItems=function(a){var b=[];return d.each(a,function(a,c){f.isInModules(c)||b.push(c)}),b},f.isRequire=function(a){return a?g.REQUIRE_FUN.test(a):!1},f.moduleSet=function(a,b,c){if(a=f.aliasId(a),f.isInModules(a)&&d.isFunction(c)){if(f.isRequire(c.toString()))return c(this.declare),void 0;throw'module "'+a+'" already defined!'}d.isFunction(c)&&(i[a]={id:a,dependencies:b,factory:c})},f.compile=function(a){a=f.aliasId(a),v=f.aliasId(a,"v"),d.each(j,function(b,c){function e(){for(var b=0,c=g.length;c>b;b++)if(g[b]===a)return g.splice(b,1),f.compile(a),void 0}if(c){var g=c.links||[];if(d.isInArray(g,a)||d.isInArray(g,v)){if(g.length<=1){var h=c.id||d.uid(),k=c.dependencies||[],l=c.factory||"",m=i[a]||{},n=m.dependencies||[];k=k.concat(n),k=d.unique(k),j.splice(b,1),f.complete(h,k,l)}e()}}})},f.complete=function(a,b,c){f.moduleSet(a,b,c);var d=f.exports(a);return f.compile(a),d},f.build=function(a){var b=a.factory;a.exports={},delete a.factory;var c=b(this.declare,a.exports,a);return d.isEmptyObject(a.exports)&&(a.exports=c||{}),a.exports},f.exports=function(a){if(f.isInModules(a)){a=f.aliasId(a);var b=i[a].factory?f.build(i[a]):i[a].exports;return b}return null},f.declare=function(a,b,c){b=b||[],d.isArray(a)&&(c=b,b=a,a=""),d.isFunction(b)&&(c=b,b=[]),d.isFunction(a)&&(c=a,b=d.parseDependencies(c.toString())||[],a=""),a=a||d.uid();var e=f.noInModulesItems(b);if(e&&e.length){var g={id:a,dependencies:b,factory:c,links:d.path2name(e)};return j.push(g),f.load(b),void 0}return f.complete(a,b,c)},f.remove=function(a){a=f.aliasId(a),a&&(f.removeJS(a),delete k[a],delete i[a])}}(),a.module=a.module||{},a.module.config=f.init,a.module.alias=f.alias,a.module.files=f.files,a.module.globals=f.globals,a.module.defaults=f.defaults,a.module.declare=f.declare}(this);